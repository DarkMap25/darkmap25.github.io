<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DarkMap</title>

  <!-- Feuilles de style -->
  <style>
    /* === Styles g√©n√©raux === */
    body {
      margin: 0;
      padding: 0;
      background-color: #0d0d0d; /* Couleur de secours si l'image √©choue */
      background-image: url('./icons/background.jpg');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: scroll; /* scroll pour compatibilit√© mobile */
      color: #f0f0f0;
      font-family: 'Quicksand', sans-serif;
      position: relative;
    }

    /* Calque noir transparent par-dessus l'image */
    body::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: -1;
    }

    /* === Titre principal === */
    h1 {
      font-family: 'Quicksand', sans-serif;
      font-weight: 700;
      font-size: 6em;
      text-align: center;
      color: #e60000;
      text-shadow: 0 0 8px #e60000;
      margin: 0;
    }

    /* Sous-titre */
    .tagline {
      text-align: center;
      font-size: 1.2em;
      margin-top: 0;
      color: #ccc;
    }

    /* Logo si pr√©sent */
    .logo {
      display: block;
      margin: 20px auto 10px;
      width: 100px;
    }

    /* === Introduction (texte descriptif) === */
    .intro {
      max-width: 800px;
      margin: 30px auto;
      text-align: center;
      line-height: 1.6;
      font-size: 1.1em;
      color: #dddddd;
    }

    /* === Carte interactive === */
    #map {
      height: 75vh;
      margin: 0 auto;
      max-width: 1000px;
      border-radius: 10px;
      box-shadow: 0 0 10px #e60000;
      z-index: 1;
    }

    /* === Pied de page === */
    footer {
      text-align: center;
      padding: 20px;
      font-size: 0.9em;
      color: #777;
    }

    /* === Marqueurs emoji === */
    .emoji-marker {
      font-size: 24px;
      background: none;
      border: none;
      box-shadow: none;
      width: auto;
      height: auto;
      line-height: 1;
      color: inherit;
    }

    /* === Overlay d‚Äôintro === */
    #intro-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #0d0d0d;
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      box-sizing: border-box;
      text-align: center;
    }

    /* Texte global de l‚Äôintro (contenant les lignes) */
    #intro-text {
      font-family: 'UnifrakturCook', cursive;
      font-size: 2em;
      color: #e60000;
      text-shadow: 0 0 10px red;
      line-height: 1.6;
      text-align: center;
    }

    /* Ligne 1 : "Un territoire. Une carte." */
    .line1 {
      display: inline-block;
      white-space: nowrap;
      overflow: hidden;
      width: 0;
      animation: typingLine1 4s steps(30, end) forwards;
    }

    /* Ligne 2 : "Un pass√© sombre." */
    .line2 {
      display: inline-block;
      white-space: nowrap;
      overflow: hidden;
      width: 0;
      animation: typingLine2 3s steps(20, end) forwards;
      animation-delay: 4.2s;
      animation-fill-mode: forwards;
    }

    /* Animations lettre par lettre */
    @keyframes typingLine1 {
      from { width: 0; }
      to { width: 28ch; }
    }

    @keyframes typingLine2 {
      from { width: 0; }
      to { width: 20ch; }
    }

    /* Responsive mobile */
    @media (max-width: 600px) {
      #intro-text {
        font-size: 1.4em;
      }
    }
    @media (max-width: 768px) {
      body {
        background-attachment: scroll; /* plus s√ªr pour mobile */
        background-size: contain;
        background-position: center top;
      }
    }
  </style>

  <!-- Polices -->
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond&family=UnifrakturCook:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>

<!-- Introduction avec effet de frappe sur 2 lignes -->
<div id="intro-overlay">
  <p id="intro-text">
    <span class="line1"></span><br>
    <span class="line2"></span>
  </p>
</div>

<header>
  <h1>darkmap</h1>
  <p class="tagline">La carte de France, version Dark.</p>
</header>

<section class="intro">
  <p>
    DarkMap est un site interactif qui recense les lieux les plus sombres et √©tranges de France.<br>
    Crimes, histoires myst√©rieuses, lieux abandonn√©s ou charg√©s d‚Äôun pass√© lourd...<br>
    Chaque point sur la carte vous raconte un fragment d‚Äôun pass√© oubli√© ou d√©rangeant.<br>
    Ce projet a pour objectif de documenter, cartographier et faire d√©couvrir ces lieux atypiques.<br>
    Tous les emplacements sont choisis pour leur fiabilit√© et leur valeur historique ou intrigante.<br>
    Explorez la France autrement, √† travers ses secrets, ses drames et son pass√© sombre...
  </p>
</section>

<!-- Carte interactive -->
<div id="map"></div>

<footer>
  <p>&copy; 2025 DarkMap.fr</p>
</footer>

<!-- Script JavaScript -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  // Initialisation de la carte centr√©e sur la France
  const map = L.map('map', {
    maxBounds: [[41, -5], [52, 10]],
    minZoom: 5,
    maxZoom: 15
  }).setView([46.5, 2.5], 6);

  // Fond de carte sombre
  L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; OpenStreetMap, CartoDB',
    subdomains: 'abcd',
    maxZoom: 19
  }).addTo(map);

  // Emoji par cat√©gorie
  const emojiParCategorie = {
    "Crimes": "‚ò†Ô∏è",
    "Histoires Sombres": "‚ö∞Ô∏è",
    "Lieux Myst√©rieux": "üëÅÔ∏è",
    "Lieux Abandonn√©s": "üè∞"
  };

  // Fonction pour cr√©er un marqueur avec emoji
  function createEmojiMarker(lieu) {
    const emoji = emojiParCategorie[lieu.categorie] || "‚ùì";
    const emojiIcon = L.divIcon({
      className: 'emoji-icon',
      html: `<div class="emoji-marker">${emoji}</div>`,
      iconSize: [30, 30],
      iconAnchor: [15, 15],
      popupAnchor: [0, -15]
    });

    const popupContent = `
      <strong>${lieu.nom}</strong><br>
      ${lieu.resume}<br>
      <a href="${lieu.lien}" target="_blank">Voir plus</a>
    `;

    return L.marker([lieu.latitude, lieu.longitude], { icon: emojiIcon }).bindPopup(popupContent);
  }

  // Chargement des lieux depuis lieux.json
  fetch('lieux.json')
    .then(response => response.json())
    .then(data => {
      data.forEach(lieu => {
        createEmojiMarker(lieu).addTo(map);
      });
    })
    .catch(error => console.error('Erreur lors du chargement des lieux :', error));

  // ‚úÖ Affichage de l'intro anim√©e ou non
  let showIntro = true; // D√©claration obligatoire

  window.addEventListener("load", () => {
    const overlay = document.getElementById("intro-overlay");

    if (showIntro) {
      const line1 = document.querySelector(".line1");
      const line2 = document.querySelector(".line2");

      line1.textContent = "Un territoire. Une carte.";
      line2.textContent = "Un pass√© sombre.";

      setTimeout(() => {
        overlay.style.transition = "opacity 2s ease";
        overlay.style.opacity = 0;
        setTimeout(() => overlay.remove(), 2000);
      }, 9000); // 4s (ligne 1) + 3s (ligne 2) + 2s pause
    } else {
      overlay.style.display = "none";
    }
  });
</script>

</body>
</html>
